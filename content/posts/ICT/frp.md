---
title: "透過 frp 穿透內網：讓你的服務無遠弗屆"
date: 2025-07-07
draft: false
categories: ["網路", "工具", "伺服器架設"]
tags: ["frp", "反向代理", "內網穿透", "NAT", "防火牆", "SSH", "HTTP"]
---

## 什麼是 frp？

`frp` (Fast Reverse Proxy) 是一個快速的反向代理工具，它能協助您將位於 NAT (網路位址轉換) 或防火牆後方的本地伺服器，透過一台具有公網 IP 的伺服器，將服務暴露到網際網路。這對於那些沒有公網 IP 但又希望外部能夠訪問其內網服務的用戶來說，是個極為實用的解決方案。

`frp` 目前支援 **TCP**、**UDP**、**HTTP** 和 **HTTPS** 等多種協定，甚至還提供了 P2P 連線模式，讓資料傳輸更加靈活。

## 為什麼你需要使用 frp？

在許多情況下，我們的電腦或伺服器位於家庭網路、公司內部網路或校園網路中，這些網路通常都使用了 NAT 或防火牆，導致外部用戶無法直接訪問內網中的服務。`frp` 就是為了解決這個問題而生。以下是一些常見的使用場景：

1.  **遠端訪問內網設備：** 您可能想從外部網路遠端登入家中的NAS、桌面電腦或樹莓派等設備。透過 `frp`，即使這些設備沒有公網 IP，您也能輕鬆透過 SSH、VNC 或遠端桌面進行連接。
2.  **架設私人網站/服務：** 如果您想在自己的電腦上搭建一個網站、部落格或其他網路服務，但又不想購買虛擬主機或雲服務器，`frp` 可以讓您的本地服務透過公網 IP 被訪問。
3.  **遊戲伺服器：** 想要和朋友一起玩自己架設的遊戲伺服器（例如 Minecraft、Terraria 等），但朋友無法連線到您的內網 IP？`frp` 能讓您的伺服器對外可見。
4.  **開發測試：** 在開發 Web 應用程式時，您可能需要將本地的開發環境暴露給外部進行測試或演示，而 `frp` 提供了一個快速簡便的方法。
5.  **隱私與安全：** `frp` 提供了加密和壓縮功能，確保資料傳輸的安全性。其 STCP (Secret TCP) 模式甚至可以要求預共享金鑰才能訪問服務，進一步提升安全性。

總之，`frp` 讓內網服務不再受限於網路環境，為個人和開發者提供了極大的便利性和可能性。

## frp 的架構

`frp` 主要由兩部分組成：

*   **`frps` (frp server)：** 運行在具有公網 IP 的伺服器上，負責接收來自 `frpc` 的連線請求，並將外部的流量轉發到正確的內部服務。
*   **`frpc` (frp client)：** 運行在您要暴露的本地服務所在的設備上，負責與 `frps` 建立連線，並將本地服務的流量導向 `frps`。

![frp architecture](https://raw.githubusercontent.com/fatedier/frp/dev/doc/pic/architecture.png)

想像一下，`frps` 就像一個「中繼站」，而 `frpc` 則是內網中的「偵察兵」。偵察兵首先聯繫上中繼站，告訴它「我這裡有一個 SSH 服務在 22 port 上」，然後中繼站就在自己的公網 IP 上開啟一個指定的 port (例如 6000)，當外部用戶連接到中繼站的 6000 port 時，中繼站就會把流量轉發給偵察兵，最終連接到內網的 SSH 服務。

## frp 基本使用範例：透過 SSH 遠端連線內網電腦

接下來，我們將以最常見的 SSH 連線為例，示範如何使用 `frp`。

**準備工作：**

1.  **下載 `frp`：** 從 [frp 的 GitHub Release 頁面](https://github.com/fatedier/frp/releases) 下載適用於您作業系統和架構的最新版本。通常會下載到一個包含 `frps` 和 `frpc` 二進位檔的壓縮包。
2.  **兩台機器：**
    *   **伺服器 A (frps)**：一台擁有公網 IP 的機器，例如您的雲伺服器 (CentOS, Ubuntu 等)。
    *   **伺服器 B (frpc)**：一台位於 NAT 或防火牆後的內網機器，上面運行著您想暴露的服務 (例如 SSH 服務在 22 端口)。

**步驟一：配置 `frps` 伺服器 (A 伺服器)**

1.  將下載的 `frps` 二進位檔和 `frps.toml` 設定檔放到伺服器 A 上。
2.  打開 `frps.toml` 檔案，並設定 `bindPort`，這是 `frpc` 用來連接 `frps` 的端口：

    ```toml
    # frps.toml
    bindPort = 7000
    ```

3.  在伺服器 A 上啟動 `frps`：

    ```bash
    ./frps -c ./frps.toml
    ```
    （注意：`frps` 後台運行方式請參考相關 Linux/Windows 服務配置教學）

**步驟二：配置 `frpc` 用戶端 (B 伺服器)**

1.  將下載的 `frpc` 二進位檔和 `frpc.toml` 設定檔放到伺服器 B 上。
2.  打開 `frpc.toml` 檔案，設定 `serverAddr` 為伺服器 A 的公網 IP 地址，`serverPort` 為 `frps` 的 `bindPort`。接著，配置您的 SSH 代理服務：

    ```toml
    # frpc.toml
    serverAddr = "x.x.x.x" # 替換為您 frps 伺服器 (A 伺服器) 的公網 IP
    serverPort = 7000

    [[proxies]]
    name = "ssh"            # 代理名稱，可自定義
    type = "tcp"            # 代理類型為 TCP
    localIP = "127.0.0.1"   # 本地服務的 IP，通常是 127.0.0.1
    localPort = 22          # 本地 SSH 服務的端口
    remotePort = 6000       # frps 伺服器上開放的端口，供外部連接
    ```
    **重要提示：** `localPort` 是 `frpc` 監聽內網服務的端口（例如 SSH 預設 22），`remotePort` 是 `frps` 在公網上為該服務開放的端口，外部用戶將連接 `frps` 的 `remotePort`。

3.  在伺服器 B 上啟動 `frpc`：

    ```bash
    ./frpc -c ./frpc.toml
    ```
    （同樣，`frpc` 也可配置為後台運行）

**步驟三：外部連線到內網 SSH 服務**

現在，您可以使用任何具有公網的機器，透過伺服器 A 來 SSH 連線到伺服器 B。假設伺服器 B 的 SSH 用戶名稱為 `test`：

```bash
ssh -oPort=6000 test@x.x.x.x # x.x.x.x 替換為您 frps 伺服器 (A 伺服器) 的公網 IP
```

如果一切設定正確，您將會成功連接到伺服器 B 的 SSH 服務！

## 更多 frp 功能

`frp` 還提供了許多進階功能，足以應對各種複雜需求：

*   **多個 SSH 服務共享同一端口：** 使用 `tcpmux` 類型代理實現端口復用。
*   **自定義域名訪問內部 Web 服務：** `http` 或 `https` 類型代理，配合域名解析，支援虛擬主機。
*   **文件伺服器：** 內置 `static_file` 插件，快速暴露本地文件目錄。
*   **加密與壓縮：** 內建 TLS 加密和資料壓縮，提高安全性和傳輸效率。
*   **熱重載配置：** 無需重啟 `frpc` 即可更新代理配置。
*   **儀表板 (Dashboard) 與監控：** `frps` 提供網頁儀表板，方便查看服務狀態和流量統計。
*   **身份驗證：** 支援 Token 和 OIDC 等多種驗證方式，確保只有授權用戶才能連線。
*   **負載均衡：** 支援多個 `frpc` 代理同一個服務，實現簡單的負載均衡。
*   **健康檢查：** 監測內網服務的運行狀態，自動移除不健康的代理。
*   **P2P 模式 (TCP)：** `xtcp` 模式允許客戶端之間直接傳輸大部分數據，減少中繼伺服器的壓力（對 NAT 類型有要求）。
*   **KCP/QUIC 協定支援：** 使用 UDP 底層傳輸，提高傳輸穩定性和速度。
*   **TCP 端口多路復用：** 在單一 TCP 連接上傳輸多個邏輯連接。
*   **插件機制：** 豐富的內建和第三方插件，提供更多擴展功能。

這些進階功能在 `frp` 的 `README.md` 中都有詳細的配置說明和範例，建議您在熟悉基本操作後深入研究。

## 結語

`frp` 是一個功能強大且易於使用的內網穿透工具，無論是個人開發者還是小型團隊，都能從中受益。希望這篇教學文章能幫助您理解 `frp` 的工作原理，並成功地將您的內網服務暴露到公網，享受無遠弗屆的便利！